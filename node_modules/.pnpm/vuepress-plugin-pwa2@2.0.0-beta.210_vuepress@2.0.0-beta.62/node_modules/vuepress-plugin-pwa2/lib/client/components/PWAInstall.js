import{useEventListener as h,useToggle as C}from"@vueuse/core";import{defineComponent as f,shallowRef as g,onMounted as b,h as e,ref as u,computed as w}from"vue";import{useLocaleConfig as y}from"vuepress-shared/client";import{withBase as A}from"@vuepress/client";import{l as I,C as k,A as S,a as P}from"../define-3fd15ee3.js";import"../styles/modal.scss";var W=f({name:"PWAInstallModal",props:{useHint:Boolean},emits:["canInstall","hint","close"],setup(d,{emit:o}){const l=y(I),a=g({}),i=g(),r=async()=>{const t=localStorage.getItem("manifest");if(t)a.value=JSON.parse(t);else try{const n=await(await fetch(A("manifest.webmanifest"))).json();a.value=n,localStorage.setItem("manifest",JSON.stringify(n))}catch{console.error("[PWA]: Error getting manifest, check that you have a valid web manifest or network connection")}},v=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:-t.clientWidth,top:0,behavior:"smooth"})},c=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:t.clientWidth,top:0,behavior:"smooth"})},p=async()=>{i.value&&(i.value.prompt(),document.dispatchEvent(new CustomEvent("show")),(await i.value.userChoice).outcome==="accepted"?(console.info("PWA has been installed"),o("close",!1),o("canInstall",!1)):(console.info("You choose to not install PWA"),o("close",!1),o("canInstall",!1)))},m=()=>{console.info("You accepted the install hint"),o("hint")};return b(()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&(h(window,"beforeinstallprompt",t=>{i.value=t,o("canInstall",!0),t.preventDefault()}),h("keyup",t=>{t.key==="Escape"&&o("close",!1)}),r())}),()=>{var t;return e("div",{id:"install-modal-wrapper"},[e("div",{class:"background",onClick:()=>o("close",!1)}),e("div",{class:"install-modal"},[e("div",{class:"header"},[e("button",{type:"button",class:"close-button","aria-label":l.value.close,onClick:()=>o("close",!1)},e(k)),e("div",{class:"logo"},[a.value.icons?e("img",{src:(t=a.value.icons[0])==null?void 0:t.src,alt:"App Logo"}):null,e("div",{class:"title"},[e("h1",a.value.short_name||a.value.name),e("p",{class:"desc"},l.value.explain)])])]),e("div",{class:"content"},[e("div",{class:"highlight"},[a.value.features?e("div",{class:"feature-wrapper"},[e("h3",l.value.feature),e("ul",a.value.features.map(n=>e("li",n)))]):null,a.value.screenshots?e("div",{class:"screenshot-wrapper"},[e("button",{type:"button","aria-label":l.value.prevImage,onClick:v},e(S)),e("section",{class:"screenshot"},[a.value.screenshots.map(n=>e("div",e("img",{src:n.src,alt:"App Screenshot"})))]),e("button",{type:"button","aria-label":l.value.nextImage,onClick:c},e(P))]):null]),e("div",{class:"description"},[e("h3",l.value.desc),e("p",a.value.description)])]),d.useHint?e("div",{class:"ios-text",onClick:m},[e("p",l.value.iOSInstall),e("button",{type:"button",class:"success"},"Got it!")]):e("div",{class:"button-wrapper"},[e("button",{type:"button",class:"install-button",onClick:p},[l.value.install,e("span",a.value.short_name)]),e("button",{type:"button",class:"cancel-button",onClick:()=>o("close",!1)},l.value.cancel)])])])}}}),x=f({name:"PWAInstall",setup(){const d=y(I),[o,l]=C(!1),a=u(!1),i=u(!1),r=u(!1),v=u(!1),c=u(!1),p=w(()=>r.value&&v.value&&c.value===!1),m=w(()=>i.value&&a.value||p.value),t=()=>navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches,n=()=>{l(!1),c.value=!0,localStorage.setItem("iOS-pwa-hint","hinted")};return b(()=>{if(t()){const{userAgent:s}=navigator;r.value=s.includes("iPhone")||s.includes("iPad")||!!(s.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2),v.value=navigator.userAgent.includes("Safari")&&!s.includes("Chrome"),c.value=!!localStorage.getItem("iOS-pwa-hint")}"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then(s=>{i.value=s.length>0})}),()=>e("div",{id:"pwa-install"},[m.value?e("button",{type:"button",class:"modal-button",onClick:()=>{l(!0)}},d.value.install):null,e(W,{style:{display:o.value?"block":"none"},useHint:p.value,onCanInstall:s=>{a.value=s},onHint:()=>n(),onClose:()=>l(!1)})])}});export{x as default};
//# sourceMappingURL=PWAInstall.js.map
