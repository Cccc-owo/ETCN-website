import{h as o,defineComponent as d,ref as p,computed as m,nextTick as O,onMounted as h}from"vue";import{n as T}from"../../FadeSlideY-7bc1af85.js";import{usePageFrontmatter as V,usePageData as w}from"@vuepress/client";import{IconBase as _,keys as H,startsWith as I}from"vuepress-shared/client";import{a as M,b as x}from"../../themeData-ed37366d.js";import{useStorage as E,useSessionStorage as b}from"@vueuse/core";import{compareSync as f}from"bcrypt-ts/browser";import{isPlainObject as G}from"@vuepress/shared";import"@vuepress/plugin-theme-data/client";const g=()=>o(_,{name:"lock"},()=>o("path",{d:"M787.168 952.268H236.832c-30.395 0-55.033-24.638-55.033-55.033V429.45c0-30.395 24.638-55.034 55.033-55.034h82.55V264.35c0-106.38 86.238-192.618 192.618-192.618S704.618 157.97 704.618 264.35v110.066h82.55c30.395 0 55.033 24.639 55.033 55.034v467.785c0 30.395-24.639 55.033-55.033 55.033zM484.483 672.046v115.122h55.034V672.046c31.99-11.373 55.033-41.605 55.033-77.496 0-45.592-36.958-82.55-82.55-82.55s-82.55 36.958-82.55 82.55c0 35.89 23.042 66.123 55.033 77.496zM622.067 264.35c0-60.788-49.28-110.067-110.067-110.067s-110.067 49.28-110.067 110.067v110.066h220.135V264.35z"}));g.displayName="LockIcon";var k=d({name:"PasswordModal",props:{full:Boolean},emits:["verify"],setup(l,{emit:t}){const r=V(),s=M(),n=p(""),e=p(!1),a=p(!1),u=m(()=>s.value.encryptLocales);let i=null;const c=()=>{i&&clearTimeout(i),e.value=!1,t("verify",n.value,a.value),O().then(()=>{e.value=!0,i=setTimeout(()=>{e.value=!1},1e3)})};return()=>o("div",{class:["password-layer",{expand:l.full||r.value.home}]},o("div",{class:"password-modal"},[o("div",{class:["hint",{tried:e.value}]},e.value?u.value.errorHint:o(g,{"aria-label":u.value.iconLabel})),o("div",{class:"password"},[o("input",{type:"password",value:n.value,placeholder:u.value.placeholder,onInput:({target:v})=>{n.value=v.value},onKeydown:({key:v})=>{v==="Enter"&&c()}})]),o("div",{class:"remember-password"},[o("input",{type:"checkbox",value:a.value,onChange:()=>a.value=!a.value}),u.value.remember]),o("button",{type:"button",class:"submit",onClick:()=>c()},"OK")]))}});const P=()=>{const l=x();return m(()=>l.value.encrypt||{})},S="VUEPRESS_HOPE_GLOBAL_TOKEN",K=()=>{const l=P(),t=E(S,""),r=b(S,""),s=m(()=>{const{global:e=!1,admin:a=[]}=l.value;return e&&a.length>0}),n=m(()=>{if(s.value){if(t.value)return l.value.admin.some(e=>f(t.value,e));if(r.value)return l.value.admin.some(e=>f(r.value,e))}return!1});return{isEncrypted:s,isDecrypted:n,validate:(e,a=!1)=>{(a?t:r).value=e}}},y=(l="",t)=>!!l&&f(l,t),D="VUEPRESS_HOPE_PATH_TOKEN",j=()=>{const l=w(),t=P(),r=E(D,{}),s=b(D,{}),n=a=>G(t.value.config)?H(t.value.config).filter(u=>I(decodeURI(a),u)).sort((u,i)=>i.length-u.length):[],e=a=>{const u=n(a);if(u.length>0){const{config:i={}}=t.value;return{isEncrypted:!0,isDecrypted:u.some(c=>r.value[c]&&i[c].some(v=>y(r.value[c],v))||s.value[c]&&i[c].some(v=>y(s.value[c],v)))}}return{isDecrypted:!1,isEncrypted:!1}};return{status:m(()=>e(l.value.path)),getStatus:e,validate:(a,u=!1)=>{const{config:i={}}=t.value,c=n(l.value.path);for(const v of c)if(i[v].filter(L=>y(a,L))){(u?r:s).value[v]=a;break}}}};var z=d({name:"GlobalEncrypt",slots:Object,setup(l,{slots:t}){const{isDecrypted:r,isEncrypted:s,validate:n}=K(),e=p(!1);return h(()=>{e.value=!0}),()=>o(T,()=>s.value?e.value?r.value?t.default():o(k,{full:!0,onVerify:n}):null:t.default())}}),B=d({name:"LocalEncrypt",slots:Object,setup(l,{slots:t}){const{status:r,validate:s}=j(),n=p(!1);return h(()=>{n.value=!0}),()=>{const{isEncrypted:e,isDecrypted:a}=r.value;return e?n.value?a?t.default()||null:o(k,{full:!0,onVerify:s}):null:t.default()||null}}});export{z as GlobalEncrypt,B as LocalEncrypt};
//# sourceMappingURL=export.js.map
