{"version":3,"file":"Twikoo.js","sources":["../../../src/client/components/Twikoo.ts"],"sourcesContent":["import { usePageData, usePageLang } from \"@vuepress/client\";\nimport {\n  type VNode,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  ref,\n  watch,\n} from \"vue\";\nimport { LoadingIcon } from \"vuepress-shared/client\";\n\nimport { useTwikooOptions } from \"../helpers/index.js\";\n\nimport \"../styles/twikoo.scss\";\n\nexport default defineComponent({\n  name: \"TwikooComment\",\n\n  props: {\n    /**\n     * The path of the comment\n     */\n    identifier: {\n      type: String,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const twikooOptions = useTwikooOptions();\n    const lang = usePageLang();\n    const page = usePageData();\n\n    const loaded = ref(false);\n\n    const enableTwikoo = Boolean(twikooOptions.envId);\n\n    const initTwikoo = async (): Promise<void> => {\n      const [{ init }] = await Promise.all([\n        import(/* webpackChunkName: \"twikoo\" */ \"twikoo\"),\n        new Promise<void>((resolve) => {\n          setTimeout(() => {\n            void nextTick().then(resolve);\n          }, twikooOptions.delay || 800);\n        }),\n      ]);\n\n      loaded.value = true;\n\n      await init({\n        lang: lang.value === \"zh-CN\" ? \"zh-CN\" : \"en\",\n        path: props.identifier,\n        ...twikooOptions,\n        el: \"#twikoo-comment\",\n      });\n    };\n\n    onMounted(() => {\n      watch(\n        () => page.value.path,\n        () => initTwikoo(),\n        { immediate: true }\n      );\n    });\n\n    return (): VNode | null =>\n      enableTwikoo\n        ? h(\n            \"div\",\n            { class: \"twikoo-wrapper\", id: \"comment\" },\n            loaded.value ? h(\"div\", { id: \"twikoo-comment\" }) : h(LoadingIcon)\n          )\n        : null;\n  },\n});\n"],"names":["defineComponent","props","twikooOptions","useTwikooOptions","lang","usePageLang","page","usePageData","loaded","ref","enableTwikoo","initTwikoo","init","resolve","nextTick","onMounted","watch","h","LoadingIcon"],"mappings":"0RAgBA,IAAeA,EAAAA,EAAgB,CAC7B,KAAM,gBAEN,MAAO,CAIL,WAAY,CACV,KAAM,OACN,SAAU,EACZ,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,IAChBC,EAAOC,IACPC,EAAOC,IAEPC,EAASC,EAAI,EAAK,EAElBC,EAAe,CAAQR,CAAAA,EAAc,MAErCS,EAAa,SAA2B,CAC5C,KAAM,CAAC,CAAE,KAAAC,CAAK,CAAC,EAAI,MAAM,QAAQ,IAAI,CACnC,OAAwC,QAAQ,EAChD,IAAI,QAAeC,GAAY,CAC7B,WAAW,IAAM,CACVC,EAAS,EAAE,KAAKD,CAAO,CAC9B,EAAGX,EAAc,OAAS,GAAG,CAC/B,CAAC,CACH,CAAC,EAEDM,EAAO,MAAQ,GAEf,MAAMI,EAAK,CACT,KAAMR,EAAK,QAAU,QAAU,QAAU,KACzC,KAAMH,EAAM,WACZ,GAAGC,EACH,GAAI,iBACN,CAAC,CACH,EAEA,OAAAa,EAAU,IAAM,CACdC,EACE,IAAMV,EAAK,MAAM,KACjB,IAAMK,IACN,CAAE,UAAW,EAAK,CACpB,CACF,CAAC,EAEM,IACLD,EACIO,EACE,MACA,CAAE,MAAO,iBAAkB,GAAI,SAAU,EACzCT,EAAO,MAAQS,EAAE,MAAO,CAAE,GAAI,gBAAiB,CAAC,EAAIA,EAAEC,CAAW,CACnE,EACA,IACR,CACF,CAAC"}